# 混合检索功能使用指南

## 🚀 功能概述

混合检索是我们RAG系统的核心创新功能，它智能地结合了两种检索方式：

- **向量检索**：基于语义相似性，擅长理解查询意图
- **关键字检索**：基于精确匹配，擅长查找特定术语

## ⚙️ 配置说明

在 `rag/config.py` 中可以调整以下参数：

```python
# 启用/禁用混合检索
ENABLE_HYBRID_SEARCH = True  # True: 混合检索, False: 纯向量检索

# 权重配置 (建议总和为1.0)
VECTOR_SEARCH_WEIGHT = 0.7   # 向量检索权重 (0.0-1.0)
KEYWORD_SEARCH_WEIGHT = 0.3  # 关键字检索权重 (0.0-1.0)

# 检索数量配置
RETRIEVER_TOP_K = 10         # 向量检索返回的文档数
KEYWORD_RETRIEVER_TOP_K = 5  # 关键字检索返回的文档数
RERANKER_TOP_N = 3          # 重排序后最终返回的文档数
```

## 🎯 使用场景

### 1. 语义查询 (向量检索优势)
- **查询**: "什么是机器学习？"
- **效果**: 能找到相关概念的描述，即使文档中没有完全相同的表述

### 2. 精确匹配 (关键字检索优势)
- **查询**: "RAG系统"
- **效果**: 精确找到包含这个术语的所有文档

### 3. 混合查询 (两者结合的优势)
- **查询**: "如何配置权重"
- **效果**: 既理解"配置"的语义，又匹配"权重"关键字

## 📊 权重调优建议

根据你的使用场景调整权重：

| 场景 | 向量权重 | 关键字权重 | 适用情况 |
|------|----------|------------|----------|
| 通用问答 | 0.7 | 0.3 | 平衡语义理解和精确匹配 |
| 技术文档查询 | 0.5 | 0.5 | 需要精确的技术术语匹配 |
| 概念理解 | 0.8 | 0.2 | 更注重语义理解 |
| 关键词搜索 | 0.3 | 0.7 | 更注重精确匹配 |

## 🧪 测试功能

运行测试脚本验证混合检索效果：

```bash
# 测试混合检索功能
python test_hybrid_search.py

# 运行完整的问答系统
python main.py
```

## 🔧 故障排除

### 常见问题

1. **BM25检索器构建失败**
   ```
   解决方案: pip install rank_bm25
   ```

2. **jieba分词错误**
   ```
   解决方案: pip install jieba
   ```

3. **权重配置无效**
   ```
   检查: VECTOR_SEARCH_WEIGHT + KEYWORD_SEARCH_WEIGHT 是否等于1.0
   ```

### 性能优化

- **文档数量较少时**: 可以提高关键字检索权重
- **文档数量较多时**: 可以提高向量检索权重
- **查询响应慢**: 可以减少 `RETRIEVER_TOP_K` 和 `KEYWORD_RETRIEVER_TOP_K`

## 📈 效果对比

使用混合检索后的改进：

- ✅ **召回率提升**: 结合两种检索方式，减少遗漏
- ✅ **准确性提升**: 重排序机制确保最相关的文档排在前面
- ✅ **查询覆盖面更广**: 既能处理语义查询，也能处理精确查询
- ✅ **用户体验更好**: 更准确的答案和更丰富的参考来源

## 🎉 成功案例

从我们的测试结果可以看到：

1. **语义查询**: "什么是机器学习？" → 准确找到定义
2. **关键字查询**: "RAG系统" → 精确匹配相关文档
3. **混合查询**: "如何配置权重" → 提供具体配置步骤

混合检索让你的RAG系统更智能、更准确、更实用！